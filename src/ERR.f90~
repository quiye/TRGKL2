DOUBLE PRECISION FUNCTION ERR(mode,IAP,JA,A,M,N,K,L,BK,VK,UK)
  IMPLICIT NONE

  INTEGER IAP(*),JA(*)
  DOUBLE PRECISION A(*)
  CHARACTER MODE

  INTEGER M,N,K,L,I
  DOUBLE PRECISION ONE,ZERO
  PARAMETER(ONE = 1.0D+0,ZERO = 0.0D+0)
  DOUBLE PRECISION BK(K,K),VK(N,K),UK(M,K),VMTEMP(M),VNTEMP(N)
  DOUBLE PRECISION DNRM2
  EXTERNAL DNRM2

  ERR = ZERO
  DO I = 1, L
     IF(MODE=='s') THEN
        CALL AV(M,IAP,JA,A,VK(:,I), VMTEMP)
     ELSE IF(MODE=='d') THEN
        CALL DGEMV('N',M,N,ONE,A,M,VK(:,I),1,ZERO,VMTEMP,1)
     END IF
     CALL DAXPY(M, -BK(I,I), UK(1,I), 1, VMTEMP,1)
     ERR = ERR + DNRM2(M,VMTEMP,1) / SQRT(DBLE(M))

     IF(MODE=='s') THEN
        CALL ATV(M,N,IAP,JA,A,UK(:,I), VNTEMP)
     ELSE IF(MODE=='d') THEN
        CALL DGEMV('T',M,N,ONE,A,M,UK(:,I),1,ZERO,VNTEMP,1)
     END IF
     CALL DAXPY(N, -BK(I,I), VK(1,I), 1, VNTEMP,1)
     ERR = ERR + DNRM2(N,VNTEMP,1) / SQRT(DBLE(N))
  ENDDO

  RETURN
END FUNCTION ERR

